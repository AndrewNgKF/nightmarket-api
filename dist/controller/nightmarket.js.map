{"version":3,"sources":["../../src/controller/nightmarket.js"],"names":["config","db","api","post","req","res","newNightmarket","name","body","geometry","coordinates","save","err","send","json","message","get","find","nightmarkets","findById","params","id","nightmarket","put","delete","remove","_id","newComment","text","comment","comments","push"],"mappings":"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","file":"nightmarket.js","sourcesContent":["import mongoose from 'mongoose';\nimport { Router } from 'express';\nimport Nightmarket from '../model/nightmarket';\nimport Comment from '../model/comment';\n\nimport { authenticate } from '../middleware/authmiddleware';\n\nexport default ({ config, db}) => {\n  let api = Router();\n\n  //CREATE ->  /v1/nightmarket/add\n  api.post('/add', authenticate, (req, res) => {\n    let newNightmarket = new Nightmarket();\n    newNightmarket.name = req.body.name;\n    newNightmarket.geometry.coordinates = req.body.geometry.coordinates;\n\n\n    newNightmarket.save(err => {\n      if (err) {\n        res.send(err);\n      }\n      res.json({message: 'Nightmarket saved yay'});\n    });\n  });\n\n  //READ -> /v1/nightmarket/\n  api.get('/', (req, res) => {\n    Nightmarket.find({}, (err, nightmarkets) => {\n      if (err) {\n        res.send(err);\n      }\n        res.json(nightmarkets);\n    });\n  });\n\n  //READ ONE -> /v1/nightmarket/:id\n  api.get('/:id', (req, res) => {\n    Nightmarket.findById(req.params.id, (err, nightmarket) => {\n      if (err) {\n        res.send(err);\n      }\n      res.json(nightmarket);\n    });\n  });\n\n  //UPDATE -> /v1/nightmarket/:id\n  api.put('/:id', authenticate, (req, res) => {\n    Nightmarket.findById(req.params.id, (err, nightmarket) => {\n      if (err) {\n        res.send(err);\n      }\n      nightmarket.name = req.body.name;\n      nightmarket.geometry.coordinates = req.body.geometry.coordinates;\n      nightmarket.save(err => {\n        if (err) {\n          res.send(err);\n        }\n        res.json({ message: \"Nightmarket Info Updated\"});\n      });\n    });\n  });\n\n  //DELETE -> /v1/nightmarket/:id\n  api.delete('/:id', authenticate, (req, res) => {\n    Nightmarket.remove({\n      _id: req.params.id\n    }, (err, nightmarket) => {\n      if (err) {\n        res.send(err);\n      }\n      res.json({message: \"Nightmarket is Deleted\"})\n    })\n  });\n\n  // =====================================\n    // COMMENTS\n  // =====================================\n\n  // CREATE -> /v1/nightmarket/comments/add/:id\n  api.post('/comments/add/:id', (req, res) => {\n    Nightmarket.findById(req.params.id, (err, nightmarket) => {\n      if (err) {\n        res.send(err);\n      }\n      let newComment = new Comment();\n      newComment.text = req.body.text;\n      //Link comment to Nightmarket\n      newComment.nightmarket = nightmarket._id;\n      newComment.save((err, comment) => {\n        if (err) {\n          res.send(err);\n        }\n        nightmarket.comments.push(newComment);\n        nightmarket.save(err => {\n          if (err) {\n            res.send(err);\n          }\n          res.json({ message: 'Nightmarket Comment Saved'});\n        });\n      });\n    });\n  });\n\n  // READ -> /v1/nightmarket/comments/:id\n  api.get('/comments/:id', (req, res) => {\n    Comment.find({nightmarket: req.params.id}, (err, comments) => {\n      if (err) {\n        res.send(err);\n      }\n      res.json(comments);\n    });\n  });\n\n  //add UPDATE of comments\n\n  //add DELETE of comments\n\n\n\n  return api;\n}\n"]}